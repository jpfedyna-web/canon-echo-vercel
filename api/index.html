<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canon Echo | Workforce Health Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: #0a0f1a; color: #e2e8f0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes pulse-subtle { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .animate-pulse-subtle { animation: pulse-subtle 2s ease-in-out infinite; }
        .status-pending { color: #f59e0b; background: rgba(245, 158, 11, 0.15); }
        .status-active, .status-complete { color: #22c55e; background: rgba(34, 197, 94, 0.15); }
        .status-analyzing { color: #3b82f6; background: rgba(59, 130, 246, 0.15); }
        .drop-zone { border: 2px dashed #475569; transition: all 0.2s ease; }
        .drop-zone:hover, .drop-zone.drag-over { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
    </style>
    <script>tailwind.config = { theme: { extend: { colors: { slate: { 850: '#162032', 950: '#0a0f1a' } } } } }</script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const SUPABASE_URL = 'https://ukpniztesqiwkhazcddp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrcG5penRlc3Fpd2toYXpjZGRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NTA2MDAsImV4cCI6MjA4NDQyNjYwMH0.OpV9KSoVBKwO1bQYqnGiBWHilyTiTPAxxngPW30CVu0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const Icons = {
            clients: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,
            uploads: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>,
            analyses: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
            plus: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            refresh: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
            close: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            check: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            trash: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            eye: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
            dashboard: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" /></svg>,
            file: <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
            sparkles: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>,
            loader: <svg className="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" /></svg>,
            download: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            search: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
        };
        
        const StatusBadge = ({ status }) => <span className={`px-2 py-1 rounded-full text-xs font-medium status-${status?.toLowerCase() || 'pending'}`}>{status || 'pending'}</span>;
        const StatCard = ({ title, value, icon, color }) => (<div className="bg-slate-850 border border-slate-700/50 rounded-xl p-5"><div className="flex items-center justify-between mb-3"><span className="text-slate-400 text-sm font-medium">{title}</span><div className={`p-2 rounded-lg ${color}`}>{icon}</div></div><div className="text-3xl font-bold text-white">{value}</div></div>);
        const Modal = ({ isOpen, onClose, title, children, wide }) => { if (!isOpen) return null; return (<div className="fixed inset-0 z-50 flex items-center justify-center"><div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div><div className={`relative bg-slate-850 border border-slate-700 rounded-2xl w-full ${wide ? 'max-w-5xl' : 'max-w-lg'} mx-4 max-h-[90vh] overflow-hidden flex flex-col animate-fade-in`}><div className="flex items-center justify-between p-5 border-b border-slate-700"><h3 className="text-lg font-semibold text-white">{title}</h3><button onClick={onClose} className="p-1 hover:bg-slate-700 rounded-lg">{Icons.close}</button></div><div className="p-5 overflow-y-auto">{children}</div></div></div>); };
        
        const AddClientForm = ({ onSubmit, onCancel }) => {
            const [formData, setFormData] = useState({ company_name: '', contact_name: '', contact_email: '', industry: '', funding_type: '', employee_count: '' });
            const handleSubmit = (e) => { e.preventDefault(); onSubmit({ ...formData, employee_count: formData.employee_count ? parseInt(formData.employee_count) : null }); };
            return (<form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-sm font-medium text-slate-300 mb-1">Company Name *</label><input type="text" required value={formData.company_name} onChange={(e) => setFormData({...formData, company_name: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="Acme Corporation" /></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium text-slate-300 mb-1">Contact Name</label><input type="text" value={formData.contact_name} onChange={(e) => setFormData({...formData, contact_name: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="John Smith" /></div><div><label className="block text-sm font-medium text-slate-300 mb-1">Contact Email</label><input type="email" value={formData.contact_email} onChange={(e) => setFormData({...formData, contact_email: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="john@acme.com" /></div></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium text-slate-300 mb-1">Industry</label><input type="text" value={formData.industry} onChange={(e) => setFormData({...formData, industry: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="Manufacturing" /></div><div><label className="block text-sm font-medium text-slate-300 mb-1">Funding Type</label><select value={formData.funding_type} onChange={(e) => setFormData({...formData, funding_type: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500"><option value="">Select...</option><option value="Fully Insured">Fully Insured</option><option value="Self-Funded">Self-Funded (ASO)</option><option value="Level-Funded">Level-Funded</option></select></div></div><div><label className="block text-sm font-medium text-slate-300 mb-1">Employee Count</label><input type="number" value={formData.employee_count} onChange={(e) => setFormData({...formData, employee_count: e.target.value})} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="250" /></div><div className="flex gap-3 pt-4"><button type="button" onClick={onCancel} className="flex-1 px-4 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium">Cancel</button><button type="submit" className="flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium">Add Client</button></div></form>);
        };
        
        // ============================================================
        // COMPREHENSIVE EXECUTIVE REPORT GENERATOR
        // ============================================================
        const generateFullReportHTML = (findings, client) => {
            const f = findings || {};
            const cp = f.census_profile || {};
            const gen = f.generational_breakdown || {};
            const ra = f.risk_assessment || {};
            const cs = f.cancer_screening || {};
            const fa = f.funding_analysis || {};
            const ec = f.executive_concierge || {};
            const cm = f.confidence_matrix || [];
            const intel = f.industry_intelligence || [];
            const actions = f.action_plan || [];
            const closing = f.closing || {};
            
            const employees = parseInt(cp.total_employees) || client?.employee_count || 200;
            const dependents = parseInt(cp.total_dependents) || Math.round(employees * 1.4);
            const totalLives = parseInt(cp.total_covered_lives) || employees + dependents;
            const avgAge = cp.average_age || 42;
            const today = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            const fundingType = fa.type || client?.funding_type || 'Self-Funded';
            const isFullyInsured = fundingType.toLowerCase().includes('fully');
            const isSelfFunded = fundingType.toLowerCase().includes('self') || fundingType.toLowerCase().includes('aso');
            const riskScore = parseInt(ra.overall_score) || 55;
            const riskColor = riskScore < 40 ? '#22c55e' : riskScore < 70 ? '#f59e0b' : '#ef4444';
            
            const genZ = gen.gen_z || { percentage: 15, count: Math.round(employees * 0.15), health_stats: [] };
            const mill = gen.millennials || { percentage: 25, count: Math.round(employees * 0.25), health_stats: [] };
            const genX = gen.gen_x || { percentage: 35, count: Math.round(employees * 0.35), health_stats: [] };
            const boom = gen.boomers || { percentage: 25, count: Math.round(employees * 0.25), health_stats: [] };
            
            const fundsAvail = fa.funds_available || {};
            const wellnessFund = fundsAvail.wellness_fund?.amount || fundsAvail.wellness_credits?.amount || (employees * 150);
            const innovationFund = fundsAvail.innovation_fund?.amount || (isSelfFunded ? employees * 75 : 0);
            const potentialSavings = fundsAvail.potential_savings?.amount || (employees * 225);
            
            const defaultScreenings = [
                { type: "Colorectal Cancer", eligible_count: Math.round(employees * 0.4), early_detection_survival: "91%", late_detection_survival: "14%", eligible_criteria: "Ages 45-75" },
                { type: "Breast Cancer", eligible_count: Math.round(employees * 0.22), early_detection_survival: "99%", late_detection_survival: "29%", eligible_criteria: "Women 40-74" },
                { type: "Cervical Cancer", eligible_count: Math.round(employees * 0.25), early_detection_survival: "92%", late_detection_survival: "17%", eligible_criteria: "Women 21-65" },
                { type: "Lung Cancer", eligible_count: Math.round(employees * 0.08), early_detection_survival: "60%", late_detection_survival: "6%", eligible_criteria: "Smokers 50-80" }
            ];
            const screenings = cs.screenings?.length > 0 ? cs.screenings : defaultScreenings;
            
            const defaultConfidence = [
                { metric: "Employee demographics", value: "From census", confidence: "ACTUAL", icon: "‚úÖ", source: "Census file" },
                { metric: "Generational distribution", value: "Calculated", confidence: "ACTUAL", icon: "‚úÖ", source: "Birthdates" },
                { metric: "Screening eligibility", value: "By age/gender", confidence: "ACTUAL", icon: "‚úÖ", source: "USPSTF guidelines" },
                { metric: "Chronic disease prevalence", value: "Estimated", confidence: "MODELED", icon: "‚ö†Ô∏è", source: "CDC NHANES 2022" },
                { metric: "Mental health prevalence", value: "Estimated", confidence: "MODELED", icon: "‚ö†Ô∏è", source: "NIMH 2022" },
                { metric: "Individual health status", value: "Unknown", confidence: "REQUIRES_CLAIMS", icon: "‚ùì", source: "Needs claims data" }
            ];
            const confidenceData = cm.length > 0 ? cm : defaultConfidence;
            
            const defaultIntel = [
                { category: "Rx Pricing", headline: "Medicare Drug Negotiation Impact", insight: "CMS negotiated 38-79% reductions on first 10 drugs. Commercial ripple effects within 2-3 years.", canon_position: "Discuss with PBM how this affects your contracts." },
                { category: "Cost Trends", headline: "GLP-1s Driving 9-11% Pharmacy Trend", insight: "Pharmacy trend outpacing medical due to Ozempic/Wegovy/Mounjaro utilization.", canon_position: "Cover with guardrails tied to outcomes." },
                { category: "PBM Reform", headline: "FTC Finds PBM Cost Inflation", insight: "Top 3 PBMs engage in practices that raise costs.", canon_position: isSelfFunded ? "Renegotiate. Request rebate transparency." : "Monitor developments." },
                { category: "Compliance", headline: "Mental Health Parity Enforcement", insight: "DOL MHPAEA rules require MH vs medical comparative analysis.", canon_position: "Request compliance docs before mid-2025." }
            ];
            const intelData = intel.length > 0 ? intel : defaultIntel;
            
            const defaultActions = [
                { action_number: 1, title: "Cancer Screening Activation", why_now: `${Math.round(employees * 0.6)} screening opportunities identified`, funding_source: isFullyInsured ? "Carrier Wellness" : "Wellness Fund", tactics: [
                    { letter: "A", name: "At-Home Colorectal Kits", description: "Mail FIT/Cologuard kits to employees 45-75", eligible_count: Math.round(employees * 0.4), estimated_cost: "$35-50/kit", vendor_recommendations: [{vendor: "Cologuard", why: "Highest brand recognition"}, {vendor: "LetsGetChecked", why: "Good UX, dashboard"}] },
                    { letter: "B", name: "Mobile Mammography Event", description: "On-site screening, 15-minute appointments", eligible_count: Math.round(employees * 0.22), estimated_cost: "$4,500 minimum", vendor_recommendations: [{vendor: "Alliance Mobile Health", why: "National coverage"}] },
                    { letter: "C", name: "Birthday-Month Reminders", description: "Personalized screening outreach", eligible_count: employees, estimated_cost: "$15/person", vendor_recommendations: [{vendor: "Accolade", why: "High-touch navigation"}, {vendor: "Quantum Health", why: "Claims impact focus"}] }
                ]},
                { action_number: 2, title: "Diabetes Prevention Program", why_now: `Estimated ${Math.round(totalLives * 0.35)} prediabetic individuals`, funding_source: isFullyInsured ? "Carrier Programs" : "Innovation Fund", tactics: [
                    { letter: "A", name: "CDC-Recognized DPP", description: "16-week program, 58% risk reduction proven", eligible_count: Math.round(employees * 0.3), estimated_cost: "$500/person", vendor_recommendations: [{vendor: "Omada Health", why: "Original digital DPP"}, {vendor: "Vida Health", why: "Multi-condition support"}] },
                    { letter: "B", name: "Metabolic Health Challenge", description: "4-week nutrition competition", eligible_count: employees, estimated_cost: "$40/person", vendor_recommendations: [{vendor: "Virgin Pulse", why: "Strong challenge mechanics"}] },
                    { letter: "C", name: "CGM Pilot Program", description: "Glucose monitors for highest-risk", eligible_count: 20, estimated_cost: "$300/person", vendor_recommendations: [{vendor: "Levels", why: "Best consumer UX"}, {vendor: "Nutrisense", why: "Includes dietitian"}] }
                ]},
                { action_number: 3, title: "Mental Health Activation", why_now: "Gen Z 42% affected, EAP at 3-5% utilization", funding_source: isFullyInsured ? "EAP Enhancement" : "Wellness Fund", tactics: [
                    { letter: "A", name: "Leadership 'It's OK' Campaign", description: "Senior leader shares personal MH story", eligible_count: employees, estimated_cost: "$1,500", vendor_recommendations: [{vendor: "One Mind at Work", why: "Free resources"}] },
                    { letter: "B", name: "Text-Based Therapy Platform", description: "Digital MH matching Gen Z preferences", eligible_count: Math.round(employees * (genZ.percentage || 15) / 100), estimated_cost: "$6-12 PEPM", vendor_recommendations: [{vendor: "Lyra Health", why: "Highest clinical quality"}, {vendor: "Spring Health", why: "Strong ROI data"}] },
                    { letter: "C", name: "Manager MH Training", description: "2-hour awareness workshop", eligible_count: Math.round(employees * 0.15), estimated_cost: "$5,000", vendor_recommendations: [{vendor: "Mental Health First Aid", why: "Gold standard curriculum"}] }
                ]}
            ];
            const actionData = actions.length > 0 ? actions : defaultActions;
            
            const defaultConcierge = {
                headline: "Your Personalized Vendor Activation Plan",
                priority_recommendations: [
                    { category: "Care Navigation", why_you_need_it: "Help employees find right care at right time", top_picks: [{vendor: "Accolade", positioning: "Premium", cost_range: "$8-15 PEPM"}, {vendor: "Quantum Health", positioning: "Value", cost_range: "$6-12 PEPM"}] },
                    { category: "Mental Health", why_you_need_it: "Address 42% Gen Z anxiety/depression", top_picks: [{vendor: "Lyra Health", positioning: "Best Clinical", cost_range: "$7-12 PEPM"}, {vendor: "Spring Health", positioning: "ROI Focus", cost_range: "$6-10 PEPM"}] },
                    { category: "Diabetes Prevention", why_you_need_it: "Reach 30-40% prediabetic", top_picks: [{vendor: "Omada Health", positioning: "Proven DPP", cost_range: "$500/person"}, {vendor: "Virta Health", positioning: "Reversal", cost_range: "$400/month"}] },
                    { category: "Screening", why_you_need_it: "Close preventive gaps", top_picks: [{vendor: "Color Health", positioning: "Comprehensive", cost_range: "$5-10 PEPM"}, {vendor: "Cologuard", positioning: "At-Home", cost_range: "$35/kit"}] }
                ],
                next_steps: ["Schedule vendor discovery calls this week", "Request case studies for your industry", "Ask for pilot pricing", "Establish baseline metrics now"]
            };
            const conciergeData = ec.priority_recommendations ? ec : defaultConcierge;

            return `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workforce Health Intelligence | ${client?.company_name || 'Client'} | Canon Echo</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,sans-serif;background:#000;color:#fff}
.slide{min-height:100vh;padding:60px 80px;display:flex;flex-direction:column;justify-content:center;position:relative;overflow:hidden;page-break-after:always}
@media print{.slide{min-height:100vh;padding:40px 60px}}
.cover{background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);text-align:center}
.cover .company{font-size:14px;text-transform:uppercase;letter-spacing:4px;color:#64748b;margin-bottom:40px}
.cover h1{font-size:64px;font-weight:800;line-height:1.1;margin-bottom:30px}
.cover h1 span{color:#f59e0b}
.cover .subtitle{font-size:20px;color:#94a3b8;font-weight:300}
.cover .funding-badge{display:inline-block;margin-top:30px;padding:8px 20px;background:rgba(59,130,246,0.2);border:1px solid rgba(59,130,246,0.3);border-radius:20px;font-size:12px;color:#60a5fa}
.ai-tag{position:absolute;bottom:60px;left:50%;transform:translateX(-50%);background:rgba(245,158,11,0.15);border:1px solid rgba(245,158,11,0.3);padding:10px 24px;border-radius:30px;font-size:12px;letter-spacing:2px;color:#f59e0b}
.mission-slide{background:linear-gradient(135deg,#1e3a5f 0%,#1e40af 100%);text-align:center}
.mission-slide h2{font-size:14px;text-transform:uppercase;letter-spacing:4px;color:rgba(255,255,255,0.5);margin-bottom:40px}
.mission-slide .quote{font-size:36px;font-weight:300;line-height:1.5;max-width:900px;margin:0 auto 50px auto}
.mission-slide .quote em{color:#f59e0b;font-style:normal}
.mission-values{display:flex;justify-content:center;gap:60px;margin-top:50px}
.mission-value{text-align:center}
.mission-value .icon{font-size:32px;margin-bottom:16px}
.mission-value h3{font-size:16px;font-weight:600;margin-bottom:8px}
.mission-value p{font-size:14px;color:rgba(255,255,255,0.6);max-width:200px}
.section-slide{background:#0f172a}
.section-slide h2{font-size:14px;text-transform:uppercase;letter-spacing:4px;color:#64748b;margin-bottom:12px}
.section-slide .headline{font-size:42px;font-weight:800;margin-bottom:16px;line-height:1.2}
.section-slide .subhead{font-size:16px;color:#94a3b8;margin-bottom:40px;max-width:800px}
.census-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;margin-bottom:40px}
.census-stat{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:32px;text-align:center}
.census-stat .value{font-size:56px;font-weight:800;margin-bottom:8px}
.census-stat .value.blue{color:#3b82f6}
.census-stat .value.amber{color:#f59e0b}
.census-stat .value.green{color:#22c55e}
.census-stat .label{font-size:14px;color:#94a3b8;font-weight:500}
.census-stat .detail{font-size:12px;color:#64748b;margin-top:8px}
.insight-box{background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);border-radius:16px;padding:28px;display:flex;align-items:start;gap:20px}
.insight-box .icon{font-size:28px;flex-shrink:0}
.insight-box .content h4{font-size:16px;font-weight:600;margin-bottom:10px;color:#60a5fa}
.insight-box .content p{font-size:14px;color:#cbd5e1;line-height:1.6}
.funding-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:36px;margin-bottom:24px}
.funding-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:28px}
.funding-type{font-size:22px;font-weight:700}
.funding-badge-green{padding:8px 16px;background:rgba(34,197,94,0.2);color:#4ade80;border-radius:20px;font-size:12px;font-weight:600}
.funding-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.fund-box{background:rgba(255,255,255,0.03);border-radius:16px;padding:24px;text-align:center}
.fund-box .fund-amount{font-size:32px;font-weight:700;color:#4ade80;margin-bottom:10px}
.fund-box .fund-label{font-size:14px;color:#94a3b8;margin-bottom:8px;font-weight:500}
.fund-box .fund-desc{font-size:12px;color:#64748b}
.gen-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
.gen-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:24px}
.gen-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.gen-name{font-size:15px;font-weight:700}
.gen-pct{font-size:28px;font-weight:800}
.gen-card.genz .gen-pct{color:#a855f7}
.gen-card.millennial .gen-pct{color:#3b82f6}
.gen-card.genx .gen-pct{color:#f59e0b}
.gen-card.boomer .gen-pct{color:#ef4444}
.gen-meta{font-size:11px;color:#64748b;margin-bottom:16px}
.gen-insight{background:rgba(255,255,255,0.03);border-radius:10px;padding:14px;margin-bottom:10px}
.gen-insight .insight-stat{font-size:22px;font-weight:700;color:#f59e0b;margin-bottom:6px}
.gen-insight .insight-text{font-size:11px;color:#94a3b8;line-height:1.5}
.cancer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:40px}
.cancer-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:28px;text-align:center}
.cancer-card .type{font-size:16px;font-weight:700;margin-bottom:20px;color:#f59e0b}
.cancer-card .survival{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}
.cancer-card .survival .early{font-size:36px;font-weight:800;color:#22c55e}
.cancer-card .survival .vs{font-size:14px;color:#64748b}
.cancer-card .survival .late{font-size:36px;font-weight:800;color:#ef4444}
.cancer-card .survival-label{font-size:11px;color:#64748b;margin-bottom:20px;text-transform:uppercase;letter-spacing:1px}
.cancer-card .eligible{font-size:14px;color:#94a3b8}
.cancer-card .eligible strong{color:#fff}
.confidence-table{width:100%;border-collapse:collapse;margin-bottom:24px}
.confidence-table th{text-align:left;padding:14px 18px;background:rgba(255,255,255,0.05);font-size:12px;text-transform:uppercase;letter-spacing:1px;color:#64748b}
.confidence-table td{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.05);font-size:13px}
.confidence-badge{padding:5px 12px;border-radius:12px;font-size:11px;font-weight:600}
.confidence-badge.actual{background:rgba(34,197,94,0.2);color:#4ade80}
.confidence-badge.modeled{background:rgba(245,158,11,0.2);color:#fbbf24}
.confidence-badge.requires_claims{background:rgba(239,68,68,0.2);color:#f87171}
.risk-slide{background:linear-gradient(135deg,#450a0a 0%,#7f1d1d 50%,#0f172a 100%)}
.risk-display{display:flex;align-items:center;gap:60px;margin-bottom:40px}
.risk-circle{width:200px;height:200px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;border:10px solid}
.risk-circle .score{font-size:72px;font-weight:800}
.risk-circle .label{font-size:12px;text-transform:uppercase;letter-spacing:2px;opacity:0.7}
.risk-details{flex:1}
.risk-item{background:rgba(255,255,255,0.05);border-radius:14px;padding:22px;margin-bottom:18px}
.risk-item h4{font-size:17px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:10px}
.risk-item .severity{font-size:11px;padding:3px 10px;border-radius:10px;background:rgba(239,68,68,0.2);color:#f87171}
.risk-item p{font-size:13px;color:rgba(255,255,255,0.75);line-height:1.5}
.intel-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}
.intel-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:28px}
.intel-header{display:flex;justify-content:space-between;margin-bottom:14px}
.intel-category{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#f59e0b;font-weight:600}
.intel-card h4{font-size:16px;font-weight:600;margin-bottom:14px;line-height:1.3}
.intel-impact{font-size:13px;color:#94a3b8;line-height:1.6;margin-bottom:18px}
.canon-position{font-size:13px;color:#60a5fa;padding:14px;background:rgba(59,130,246,0.1);border-radius:10px;line-height:1.5}
.action-slide{background:#0f172a}
.action-slide .headline{display:flex;align-items:center;gap:20px;font-size:38px;font-weight:800;margin-bottom:12px}
.action-number{width:56px;height:56px;background:#f59e0b;color:#000;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:24px;flex-shrink:0}
.action-slide .why-now{font-size:15px;color:#fbbf24;margin-bottom:8px;font-weight:500}
.action-slide .context{font-size:14px;color:#94a3b8;margin-bottom:32px}
.funding-source{display:inline-block;margin-left:16px;padding:5px 14px;background:rgba(74,222,128,0.2);color:#4ade80;border-radius:20px;font-size:11px;font-weight:600}
.action-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px}
.action-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:28px}
.action-label{font-size:11px;text-transform:uppercase;letter-spacing:2px;color:#f59e0b;margin-bottom:14px;font-weight:600}
.action-card h3{font-size:17px;font-weight:700;margin-bottom:14px;line-height:1.3}
.action-detail{font-size:13px;color:rgba(255,255,255,0.7);line-height:1.6;margin-bottom:18px}
.action-metrics{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.action-metric{background:rgba(255,255,255,0.05);border-radius:10px;padding:12px;text-align:center}
.metric-value{font-size:20px;font-weight:700;color:#4ade80}
.metric-label{font-size:9px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1px}
.vendor-tag{font-size:11px;color:#60a5fa;background:rgba(59,130,246,0.1);padding:10px 14px;border-radius:8px;line-height:1.5}
.concierge-slide{background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%)}
.concierge-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:24px;margin-bottom:36px}
.concierge-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:28px}
.concierge-card .cat{font-size:12px;text-transform:uppercase;letter-spacing:1px;color:#f59e0b;margin-bottom:10px;font-weight:600}
.concierge-card .need{font-size:14px;color:#94a3b8;margin-bottom:20px;line-height:1.5}
.vendor-pick{background:rgba(255,255,255,0.03);border-radius:12px;padding:16px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.05)}
.vendor-pick .vendor-name{font-size:15px;font-weight:600;color:#fff;margin-bottom:4px}
.vendor-pick .vendor-positioning{font-size:11px;color:#f59e0b;margin-bottom:6px}
.vendor-pick .vendor-cost{font-size:12px;color:#4ade80;font-weight:500}
.next-steps-box{background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:16px;padding:28px}
.next-steps-box h4{font-size:16px;font-weight:600;color:#f59e0b;margin-bottom:20px}
.next-steps-box ol{padding-left:24px}
.next-steps-box li{font-size:14px;color:#e2e8f0;margin-bottom:12px;line-height:1.5}
.cta-slide{background:linear-gradient(135deg,#1e3a5f 0%,#1e40af 100%);text-align:center}
.cta-slide h2{font-size:48px;font-weight:800;margin-bottom:28px;line-height:1.2}
.cta-slide .urgency{font-size:16px;color:#fbbf24;margin-bottom:20px;font-weight:500}
.cta-slide p{font-size:18px;color:rgba(255,255,255,0.85);max-width:750px;margin:0 auto 20px auto;font-weight:300;line-height:1.6}
.cta-slide .human-reminder{font-size:15px;color:rgba(255,255,255,0.7);max-width:700px;margin:0 auto 30px auto;font-style:italic;line-height:1.6}
.cta-mission{font-size:16px;color:#f59e0b;margin-bottom:44px;font-weight:600}
.cta-buttons{display:flex;gap:24px;justify-content:center}
.cta-btn{padding:18px 40px;border-radius:10px;font-size:14px;font-weight:600;text-transform:uppercase;letter-spacing:1px;cursor:pointer;border:none;transition:all 0.2s}
.cta-btn.primary{background:#f59e0b;color:#000}
.cta-btn.secondary{background:transparent;border:2px solid rgba(255,255,255,0.3);color:#fff}
.page-num{position:absolute;bottom:30px;right:50px;font-size:12px;color:rgba(255,255,255,0.3)}
.data-date{position:absolute;bottom:30px;left:50px;font-size:10px;color:rgba(255,255,255,0.2)}
</style>
</head>
<body>

<!-- SLIDE 1: COVER -->
<div class="slide cover">
<div class="company">${client?.company_name || 'Client Company'}</div>
<h1>Workforce Health<br><span>Intelligence</span></h1>
<p class="subtitle">A data-driven view of your ${employees.toLocaleString()} employees + dependents</p>
<div class="funding-badge">${fundingType}</div>
<div class="ai-tag">‚ú¶ AI-POWERED PATTERN ANALYSIS</div>
<div class="data-date">Analysis Date: ${today} | Data: Census + Benchmarks</div>
</div>

<!-- SLIDE 2: MISSION -->
<div class="slide mission-slide">
<h2>Before We Begin</h2>
<div class="quote">"Behind every data point is a <em>person</em>‚Äîsomeone's parent,<br>someone's partner, someone who deserves to know<br>what we can see before it's too late to act."</div>
<div class="mission-values">
<div class="mission-value"><div class="icon">üëÅÔ∏è</div><h3>See Earlier</h3><p>Patterns emerge in data long before symptoms appear</p></div>
<div class="mission-value"><div class="icon">ü§ù</div><h3>Act Together</h3><p>Insights mean nothing without a path forward</p></div>
<div class="mission-value"><div class="icon">‚ù§Ô∏è</div><h3>Human First</h3><p>Putting the Human back in Human Capital</p></div>
</div>
<div class="page-num">01</div>
</div>

<!-- SLIDE 3: CENSUS PROFILE -->
<div class="slide section-slide">
<h2>Your Workforce at a Glance</h2>
<div class="headline">What the Census Reveals</div>
<div class="subhead">Before we see a single claim, your demographic data tells a powerful story</div>
<div class="census-grid">
<div class="census-stat"><div class="value blue">${employees.toLocaleString()}</div><div class="label">Enrolled Employees</div><div class="detail">+ estimated ${dependents.toLocaleString()} dependents</div></div>
<div class="census-stat"><div class="value amber">${totalLives.toLocaleString()}</div><div class="label">Total Covered Lives</div><div class="detail">Your plan's full population</div></div>
<div class="census-stat"><div class="value green">${avgAge}</div><div class="label">Average Age</div><div class="detail">${avgAge > 42 ? 'Older than' : avgAge < 42 ? 'Younger than' : 'At'} industry avg (42)</div></div>
</div>
<div class="insight-box"><div class="icon">üí°</div><div class="content"><h4>Key Census Insight</h4><p>${cp.key_insight || f.executive_summary || `Your workforce demographics reveal important patterns. With an average age of ${avgAge} and ${employees} employees, your population has specific health considerations that should guide benefits strategy and preventive care priorities.`}</p></div></div>
<div class="page-num">02</div>
</div>

<!-- SLIDE 4: FUNDING TYPE -->
<div class="slide section-slide">
<h2>Your Plan Structure</h2>
<div class="headline">${fundingType}: ${isFullyInsured ? 'Working Within Your Structure' : isSelfFunded ? 'Maximum Flexibility' : 'Moderate Flexibility'}</div>
<div class="funding-card">
<div class="funding-header"><div class="funding-type">${isFullyInsured ? 'Available Carrier Resources' : 'Available Funds for Health Improvement'}</div><div class="funding-badge-green">${isFullyInsured ? 'Carrier Programs' : 'High Flexibility'}</div></div>
${isFullyInsured ? `
<div class="funding-grid">
<div class="fund-box"><div class="fund-amount">Carrier</div><div class="fund-label">Wellness Credits</div><div class="fund-desc">Programs provided by your insurance carrier</div></div>
<div class="fund-box"><div class="fund-amount">EAP</div><div class="fund-label">Included</div><div class="fund-desc">Employee Assistance Program benefits</div></div>
<div class="fund-box"><div class="fund-amount">Engagement</div><div class="fund-label">Focus Area</div><div class="fund-desc">Maximizing utilization of existing benefits</div></div>
</div>
<div style="margin-top:24px;padding:18px;background:rgba(59,130,246,0.1);border-radius:12px;text-align:center"><span style="font-size:14px;color:#60a5fa"><strong>Note:</strong> As a fully insured group, your path to impact is through engagement optimization‚Äîgetting more people to use the programs your carrier already provides.</span></div>
` : `
<div class="funding-grid">
<div class="fund-box"><div class="fund-amount">$${typeof wellnessFund === 'number' ? Math.round(wellnessFund).toLocaleString() : wellnessFund}</div><div class="fund-label">Wellness Fund</div><div class="fund-desc">Screenings, challenges, education, incentives</div></div>
<div class="fund-box"><div class="fund-amount">$${typeof innovationFund === 'number' ? Math.round(innovationFund).toLocaleString() : innovationFund}</div><div class="fund-label">Innovation Fund</div><div class="fund-desc">Pilot programs, new vendors, technology</div></div>
<div class="fund-box"><div class="fund-amount">$${typeof potentialSavings === 'number' ? Math.round(potentialSavings).toLocaleString() : potentialSavings}</div><div class="fund-label">Potential Savings</div><div class="fund-desc">ROI from proactive health management</div></div>
</div>
<div style="margin-top:24px;padding:18px;background:rgba(74,222,128,0.1);border-radius:12px;text-align:center"><span style="font-size:14px;color:#4ade80"><strong>Total Available: $${typeof wellnessFund === 'number' && typeof innovationFund === 'number' ? (Math.round(wellnessFund) + Math.round(innovationFund) + Math.round(potentialSavings)).toLocaleString() : '‚Äî'}</strong> to invest in your people's health this year</span></div>
`}
</div>
<div class="page-num">03</div>
</div>

<!-- SLIDE 5: GENERATIONAL OVERVIEW -->
<div class="slide section-slide">
<h2>Your Workforce Profile</h2>
<div class="headline">Four Generations. Different Risks. One Strategy.</div>
<div class="gen-grid">
<div class="gen-card genz"><div class="gen-header"><div class="gen-name">Gen Z</div><div class="gen-pct">${genZ.percentage || 15}%</div></div><div class="gen-meta">~${genZ.count || Math.round(employees * 0.15)} employees | Ages 18-27 | ${genZ.gender_split || '55% M / 45% F'}</div>${(genZ.health_stats || [{stat:'42%',insight:'Report anxiety/depression‚Äî3√ó more likely to seek help IF they know where'},{stat:'67%',insight:'No established PCP‚Äîaged off parents\' insurance without adult care'}]).slice(0,2).map(s => `<div class="gen-insight"><div class="insight-stat">${s.stat}</div><div class="insight-text">${s.insight}</div></div>`).join('')}</div>
<div class="gen-card millennial"><div class="gen-header"><div class="gen-name">Millennials</div><div class="gen-pct">${mill.percentage || 25}%</div></div><div class="gen-meta">~${mill.count || Math.round(employees * 0.25)} employees | Ages 28-43 | ${mill.gender_split || '52% M / 48% F'}</div>${(mill.health_stats || [{stat:'38%',insight:'Already prediabetic‚Äîmetabolic disease arriving 10 years early'},{stat:'52%',insight:'Skip preventive care‚Äî"I\'ll do it when things calm down"'}]).slice(0,2).map(s => `<div class="gen-insight"><div class="insight-stat">${s.stat}</div><div class="insight-text">${s.insight}</div></div>`).join('')}</div>
<div class="gen-card genx"><div class="gen-header"><div class="gen-name">Gen X</div><div class="gen-pct">${genX.percentage || 35}%</div></div><div class="gen-meta">~${genX.count || Math.round(employees * 0.35)} employees | Ages 44-59 | ${genX.gender_split || '50% M / 50% F'}</div>${(genX.health_stats || [{stat:'47%',insight:'Managing 2+ chronic conditions‚Äîthe "triple threat" cohort'},{stat:'28%',insight:'Overdue for cancer screening‚Äîearly detection saves lives'}]).slice(0,2).map(s => `<div class="gen-insight"><div class="insight-stat">${s.stat}</div><div class="insight-text">${s.insight}</div></div>`).join('')}</div>
<div class="gen-card boomer"><div class="gen-header"><div class="gen-name">Boomers</div><div class="gen-pct">${boom.percentage || 25}%</div></div><div class="gen-meta">~${boom.count || Math.round(employees * 0.25)} employees | Ages 60+ | ${boom.gender_split || '54% M / 46% F'}</div>${(boom.health_stats || [{stat:'4.2',insight:'Average prescriptions‚Äî23% on combos needing monitoring'},{stat:'$47K',insight:'Annual spend‚Äîbut 40% is influenceable'}]).slice(0,2).map(s => `<div class="gen-insight"><div class="insight-stat">${s.stat}</div><div class="insight-text">${s.insight}</div></div>`).join('')}</div>
</div>
<div class="page-num">04</div>
</div>

<!-- SLIDE 6: CANCER SCREENING -->
<div class="slide section-slide">
<h2>The Stakes Are Real</h2>
<div class="headline">${cs.headline || 'Early Detection Changes Everything'}</div>
<div class="subhead">${cs.urgency_statement || 'Your workforce has significant screening opportunities. Every month of delay is risk.'}</div>
<div class="cancer-grid">
${screenings.slice(0,4).map(s => `<div class="cancer-card"><div class="type">${s.type}</div><div class="survival"><span class="early">${s.early_detection_survival || s.early_survival}</span><span class="vs">vs</span><span class="late">${s.late_detection_survival || s.late_survival}</span></div><div class="survival-label">5-year survival</div><div class="eligible"><strong>~${s.eligible_count}</strong><br>${s.eligible_criteria}</div></div>`).join('')}
</div>
<div style="text-align:center;font-size:17px;color:rgba(255,255,255,0.9);padding:20px;background:rgba(255,255,255,0.03);border-radius:12px"><strong>Every screening is covered at 100%.</strong> The only barriers are awareness‚Äîand action.</div>
<div class="page-num">05</div>
</div>

<!-- SLIDE 7: CONFIDENCE TABLE -->
<div class="slide section-slide">
<h2>What We Know vs. What We're Estimating</h2>
<div class="headline">Transparency Builds Trust</div>
<table class="confidence-table">
<thead><tr><th style="width:25%">Metric</th><th style="width:25%">Value</th><th style="width:20%">Confidence</th><th style="width:30%">Source</th></tr></thead>
<tbody>
${confidenceData.map(c => `<tr><td>${c.metric}</td><td>${c.value}</td><td><span class="confidence-badge ${(c.confidence || '').toLowerCase().replace('_', '')}">${c.icon || ''} ${c.confidence === 'ACTUAL' ? 'Actual Data' : c.confidence === 'MODELED' ? 'Modeled' : 'Requires Claims'}</span></td><td>${c.source}</td></tr>`).join('')}
</tbody>
</table>
<div style="padding:18px;background:rgba(255,255,255,0.03);border-radius:12px;text-align:center"><span style="font-size:14px;color:#94a3b8"><strong>To increase precision:</strong> Share claims data and this report transforms from directional to precise.</span></div>
<div class="page-num">06</div>
</div>

<!-- SLIDE 8: RISK ASSESSMENT -->
<div class="slide risk-slide">
<h2>Population Health Risk</h2>
<div class="headline" style="margin-bottom:44px;color:#fff">Risk Profile Assessment</div>
<div class="risk-display">
<div class="risk-circle" style="border-color:${riskColor}"><div class="score" style="color:${riskColor}">${riskScore}</div><div class="label">Risk Score</div></div>
<div class="risk-details">
<div class="risk-item"><h4>Category: ${ra.category || (riskScore < 40 ? 'Low' : riskScore < 70 ? 'Moderate' : 'Elevated')} <span style="opacity:0.7">|</span> Trend: ${ra.trend_indicator || 'Stable'}</h4><p>${ra.score_rationale || 'Population health risks identified from demographic analysis. Key factors include age distribution, chronic disease prevalence, and preventive care gaps.'}</p></div>
${(ra.top_risks || [{risk:'Chronic Disease Management',severity:'High',affected:'Gen X and Boomers',why_matters:'Unmanaged conditions drive 60% of claims costs'}]).slice(0,2).map(r => `<div class="risk-item"><h4>${r.risk} <span class="severity">${r.severity}</span></h4><p><strong>${r.affected || r.affected_population}</strong>: ${r.why_matters}</p></div>`).join('')}
</div>
</div>
<div class="page-num">07</div>
</div>

<!-- SLIDE 9: INDUSTRY INTEL -->
<div class="slide section-slide">
<h2>Industry Intelligence</h2>
<div class="headline">What's Happening in Healthcare</div>
<div class="subhead">Our position on developments affecting your plan | Updated ${today}</div>
<div class="intel-grid">
${intelData.slice(0,4).map(i => `<div class="intel-card"><div class="intel-header"><span class="intel-category">${i.category}</span></div><h4>${i.headline}</h4><div class="intel-impact">${i.insight}</div><div class="canon-position"><strong>Our Position:</strong> ${i.canon_position}</div></div>`).join('')}
</div>
<div class="page-num">08</div>
</div>

<!-- SLIDES 10-12: ACTION PLANS -->
${actionData.slice(0,3).map((action, idx) => `
<div class="slide action-slide">
<h2>Turning Insight Into Action</h2>
<div class="headline"><div class="action-number">${action.action_number || idx + 1}</div>${action.title}</div>
<div class="why-now">${action.why_now || action.rationale}</div>
<div class="context">Investment from: <span class="funding-source">${action.funding_source}</span></div>
<div class="action-grid">
${(action.tactics || []).slice(0,3).map((t, i) => `<div class="action-card"><div class="action-label">Action ${t.letter || String.fromCharCode(65 + i)}</div><h3>${t.name}</h3><div class="action-detail">${t.description}</div><div class="action-metrics"><div class="action-metric"><div class="metric-value">${t.eligible_count || '‚Äî'}</div><div class="metric-label">Eligible</div></div><div class="action-metric"><div class="metric-value">${t.estimated_cost || t.cost || '‚Äî'}</div><div class="metric-label">Est. Cost</div></div></div><div class="vendor-tag">üí° <strong>Vendors:</strong> ${(t.vendor_recommendations || []).map(v => v.vendor || v).slice(0,2).join(', ') || t.vendor || 'Contact for recommendations'}</div></div>`).join('')}
</div>
<div class="page-num">${9 + idx}</div>
</div>
`).join('')}

<!-- SLIDE 13: EXECUTIVE CONCIERGE -->
<div class="slide concierge-slide">
<h2>Executive Concierge</h2>
<div class="headline" style="margin-bottom:12px">${conciergeData.headline || 'Your Personalized Vendor Activation Plan'}</div>
<div class="subhead" style="margin-bottom:36px">${conciergeData.intro || 'Based on your specific workforce demographics, here are the vendors best positioned to help:'}</div>
<div class="concierge-grid">
${(conciergeData.priority_recommendations || []).slice(0,4).map(rec => `<div class="concierge-card"><div class="cat">${rec.category}</div><div class="need">${rec.why_you_need_it}</div>${(rec.top_picks || []).slice(0,2).map(v => `<div class="vendor-pick"><div class="vendor-name">${v.vendor}</div><div class="vendor-positioning">${v.positioning || v.why_them || ''}</div><div class="vendor-cost">${v.cost_range}</div></div>`).join('')}</div>`).join('')}
</div>
<div class="next-steps-box"><h4>Recommended Next Steps</h4><ol>${(conciergeData.next_steps || ['Schedule vendor calls', 'Request case studies', 'Pilot with 10-15%', 'Set baseline metrics']).map(s => `<li>${s}</li>`).join('')}</ol></div>
<div class="page-num">12</div>
</div>

<!-- SLIDE 14: CTA -->
<div class="slide cta-slide">
<h2>${closing.headline || 'The Patterns Are Clear.<br>The Path Is Ready.'}</h2>
<p class="urgency">${closing.urgency || 'Every month of delay is another month where preventable conditions go undetected.'}</p>
<p>${closing.message || `Your census data has revealed specific, actionable opportunities. The question is not whether to act‚Äîit's which actions to prioritize first.`}</p>
<p class="human-reminder">${closing.human_reminder || 'Behind every data point is a person‚Äîsomeone\'s parent, someone\'s partner, someone\'s child. The patterns we\'ve identified represent real opportunities to help real people.'}</p>
<p class="cta-mission">${closing.tagline || 'Putting the Human back in Human Capital.'}</p>
<div class="cta-buttons">
<button class="cta-btn primary">${closing.cta_primary || "Let's Build Your Action Plan"}</button>
<button class="cta-btn secondary">${closing.cta_secondary || 'Request Claims Analysis'}</button>
</div>
<div class="page-num">13</div>
</div>

</body>
</html>`;
        };
        
        // Summary View Component
        const SummaryView = ({ findings }) => {
            const f = findings || {};
            const ra = f.risk_assessment || {};
            const ec = f.executive_concierge || {};
            return (
                <div className="space-y-4">
                    {f.executive_summary && <div className="bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/30 rounded-xl p-4"><h4 className="text-sm font-semibold text-blue-400 uppercase tracking-wider mb-2">Executive Summary</h4><p className="text-white leading-relaxed">{f.executive_summary}</p></div>}
                    {ra.overall_score && <div className="bg-slate-900/50 rounded-xl p-4"><h4 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Risk Assessment</h4><div className="flex items-center gap-6"><div className="text-center"><div className={`text-4xl font-bold ${ra.overall_score < 40 ? 'text-green-400' : ra.overall_score < 70 ? 'text-amber-400' : 'text-red-400'}`}>{ra.overall_score}</div><div className="text-slate-500 text-sm">Risk Score</div></div><div className="flex-1 space-y-2"><div className="flex justify-between text-sm"><span className="text-slate-400">Category</span><span className="text-white">{ra.category || 'Moderate'}</span></div><div className="flex justify-between text-sm"><span className="text-slate-400">Trend</span><span className="text-white">{ra.trend_indicator || 'Stable'}</span></div></div></div></div>}
                    {f.action_plan?.length > 0 && <div className="bg-slate-900/50 rounded-xl p-4"><h4 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Action Plan</h4><div className="space-y-2">{f.action_plan.slice(0,3).map((a, i) => <div key={i} className="bg-slate-800/50 rounded-lg p-3"><div className="flex items-center gap-3"><span className="w-6 h-6 bg-amber-500 text-black rounded-full flex items-center justify-center text-xs font-bold">{a.action_number || i+1}</span><div><span className="text-white font-medium">{a.title}</span><p className="text-slate-400 text-xs mt-1">{a.why_now || a.rationale}</p></div></div></div>)}</div></div>}
                    {(ec.priority_recommendations?.length > 0 || ec.recommendations?.length > 0) && <div className="bg-slate-900/50 rounded-xl p-4"><h4 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Executive Concierge</h4><div className="space-y-2">{(ec.priority_recommendations || ec.recommendations || []).slice(0,3).map((r, i) => <div key={i} className="bg-slate-800/50 rounded-lg p-3"><p className="text-amber-400 text-xs uppercase tracking-wide mb-1">{r.category}</p><p className="text-white text-sm">{r.top_picks?.[0]?.vendor} ‚Äî {r.top_picks?.[0]?.cost_range}</p></div>)}</div></div>}
                </div>
            );
        };
        
        // Upload & Analyze Component (VERCEL API ENDPOINT)
        const UploadAnalyze = ({ client, onComplete, onCancel }) => {
            const [dragOver, setDragOver] = useState(false);
            const [file, setFile] = useState(null);
            const [csvData, setCsvData] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState(null);
            const [viewMode, setViewMode] = useState('summary');
            const [progress, setProgress] = useState('');
            const fileInputRef = useRef(null);
            
            const processFile = (f) => {
                setFile(f); setError(null);
                const ext = f.name.split('.').pop().toLowerCase();
                if (ext === 'csv') { Papa.parse(f, { header: true, complete: (r) => setCsvData(r.data.filter(row => Object.values(row).some(v => v))), error: (e) => setError('Parse error: ' + e.message) }); }
                else if (['xlsx', 'xls'].includes(ext)) { const reader = new FileReader(); reader.onload = (e) => { try { const wb = XLSX.read(new Uint8Array(e.target.result), { type: 'array' }); setCsvData(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { defval: '' }).filter(row => Object.values(row).some(v => v))); } catch (err) { setError('Excel error: ' + err.message); } }; reader.readAsArrayBuffer(f); }
                else { setError('Unsupported file type. Please upload CSV or Excel.'); }
            };
            
            const runAnalysis = async () => {
                if (!csvData) return; 
                setAnalyzing(true); 
                setError(null);
                setProgress('Uploading census data...');
                
                try {
                    const csvString = Papa.unparse(csvData);
                    
                    // Save upload record
                    const { data: uploadData, error: uploadError } = await supabase.from('uploads').insert([{ 
                        client_id: client.id, 
                        file_name: file.name, 
                        file_type: file.type || 'text/csv', 
                        file_url: 'local', 
                        status: 'analyzing' 
                    }]).select().single();
                    
                    if (uploadError) throw uploadError;
                    
                    setProgress('Running AI analysis (up to 60 seconds)...');
                    
                    // Call VERCEL API endpoint
                    const response = await fetch('/api/analyze', { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' }, 
                        body: JSON.stringify({ 
                            censusData: csvString, 
                            companyName: client.company_name, 
                            employeeCount: client.employee_count, 
                            fundingType: client.funding_type, 
                            industry: client.industry 
                        }) 
                    });
                    
                    if (!response.ok) {
                        const errText = await response.text();
                        throw new Error(`Analysis failed (${response.status}): ${errText}`);
                    }
                    
                    const result = await response.json();
                    
                    if (!result.success) throw new Error(result.message || 'Analysis failed');
                    
                    setProgress('Saving results...');
                    
                    // Update upload status
                    await supabase.from('uploads').update({ status: 'complete' }).eq('id', uploadData.id);
                    
                    // Save analysis
                    await supabase.from('analyses').insert([{ 
                        client_id: client.id, 
                        upload_id: uploadData.id, 
                        findings: result.findings, 
                        status: 'complete' 
                    }]);
                    
                    setResults(result.findings);
                    setProgress('');
                    
                } catch (err) { 
                    console.error('Analysis error:', err);
                    setError(err.message || 'Analysis failed'); 
                    setProgress('');
                } finally { 
                    setAnalyzing(false); 
                }
            };
            
            const downloadReport = () => { 
                const html = generateFullReportHTML(results, client); 
                const blob = new Blob([html], { type: 'text/html' }); 
                const a = document.createElement('a'); 
                a.href = URL.createObjectURL(blob); 
                a.download = `${client.company_name.replace(/\s+/g, '_')}_Canon_Echo_Report.html`; 
                a.click(); 
            };
            
            return (
                <div className="space-y-4">
                    {!results ? (
                        <>
                            <div className={`drop-zone rounded-xl p-8 text-center cursor-pointer ${dragOver ? 'drag-over' : ''}`} 
                                onDragOver={(e) => { e.preventDefault(); setDragOver(true); }} 
                                onDragLeave={() => setDragOver(false)} 
                                onDrop={(e) => { e.preventDefault(); setDragOver(false); processFile(e.dataTransfer.files[0]); }} 
                                onClick={() => fileInputRef.current?.click()}>
                                <input ref={fileInputRef} type="file" accept=".csv,.xlsx,.xls" onChange={(e) => processFile(e.target.files[0])} className="hidden" />
                                <div className="text-slate-400 mb-3">{Icons.file}</div>
                                <p className="text-white font-medium mb-1">{file ? file.name : 'Drop census file here'}</p>
                                <p className="text-slate-500 text-sm">{file ? `${csvData?.length || 0} rows loaded` : 'CSV or Excel (.xlsx)'}</p>
                            </div>
                            {error && <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-4 text-red-400 text-sm">{error}</div>}
                            {progress && <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 text-blue-400 text-sm flex items-center gap-3">{Icons.loader} {progress}</div>}
                            <div className="flex gap-3">
                                <button onClick={onCancel} className="flex-1 px-4 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium">Cancel</button>
                                <button onClick={runAnalysis} disabled={!csvData || analyzing} className="flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 disabled:cursor-not-allowed rounded-lg font-medium flex items-center justify-center gap-2">
                                    {analyzing ? <>{Icons.loader} Analyzing...</> : <>{Icons.sparkles} Run Full Analysis</>}
                                </button>
                            </div>
                        </>
                    ) : (
                        <div className="space-y-4">
                            <div className="flex items-center justify-between">
                                <div className="flex bg-slate-800 rounded-lg p-1">
                                    <button onClick={() => setViewMode('summary')} className={`px-4 py-2 rounded-md text-sm font-medium ${viewMode === 'summary' ? 'bg-blue-600 text-white' : 'text-slate-400'}`}>Summary</button>
                                    <button onClick={() => setViewMode('full')} className={`px-4 py-2 rounded-md text-sm font-medium ${viewMode === 'full' ? 'bg-blue-600 text-white' : 'text-slate-400'}`}>Full Report</button>
                                </div>
                                <button onClick={downloadReport} className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm font-medium">{Icons.download} Download Report</button>
                            </div>
                            <div className="max-h-[60vh] overflow-y-auto">
                                {viewMode === 'summary' ? <SummaryView findings={results} /> : (
                                    <div className="bg-slate-900 rounded-xl p-6 text-center">
                                        <p className="text-white text-lg mb-4">Your complete 13-slide executive report is ready!</p>
                                        <ul className="text-slate-300 text-sm text-left max-w-md mx-auto space-y-2">
                                            <li>‚úì Cover + Mission Statement</li>
                                            <li>‚úì Census Profile with Key Insights</li>
                                            <li>‚úì Funding Analysis (Funding-Type Aware)</li>
                                            <li>‚úì Generational Breakdown with Rich Stats</li>
                                            <li>‚úì Cancer Screening with Survival Rates</li>
                                            <li>‚úì Confidence Table (Actual vs. Modeled)</li>
                                            <li>‚úì Risk Assessment</li>
                                            <li>‚úì Industry Intelligence</li>
                                            <li>‚úì 3 Action Plans with Vendor Recommendations</li>
                                            <li>‚úì Executive Concierge with Personalized Vendors</li>
                                            <li>‚úì Call to Action</li>
                                        </ul>
                                        <p className="text-amber-400 text-sm mt-6">Click "Download Report" to get the full presentation</p>
                                    </div>
                                )}
                            </div>
                            <button onClick={onComplete} className="w-full px-4 py-2.5 bg-green-600 hover:bg-green-500 rounded-lg font-medium">Done</button>
                        </div>
                    )}
                </div>
            );
        };
        
        // Analysis Detail Slide-over
        const AnalysisDetail = ({ analysis, client, onClose }) => {
            const f = analysis.findings || {};
            const downloadReport = () => { const html = generateFullReportHTML(f, client); const blob = new Blob([html], { type: 'text/html' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Canon_Echo_Report.html`; a.click(); };
            return (
                <div className="fixed inset-0 z-50 flex"><div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative ml-auto w-full max-w-4xl bg-slate-850 border-l border-slate-700 h-full overflow-hidden flex flex-col animate-fade-in">
                        <div className="p-5 border-b border-slate-700 flex items-center justify-between">
                            <div><h2 className="text-xl font-bold text-white">Analysis Results</h2><p className="text-slate-400 text-sm">{new Date(analysis.created_at).toLocaleString()}</p></div>
                            <div className="flex items-center gap-3"><button onClick={downloadReport} className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm font-medium">{Icons.download} Download</button><button onClick={onClose} className="p-2 hover:bg-slate-700 rounded-lg">{Icons.close}</button></div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-5"><SummaryView findings={f} /></div>
                    </div>
                </div>
            );
        };
        
        // Client Detail Slide-over
        const ClientDetail = ({ client, uploads, analyses, onClose, onUploadAnalyze }) => {
            const clientAnalyses = analyses.filter(a => a.client_id === client.id);
            const [selectedAnalysis, setSelectedAnalysis] = useState(null);
            return (
                <div className="fixed inset-0 z-50 flex"><div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative ml-auto w-full max-w-2xl bg-slate-850 border-l border-slate-700 h-full overflow-y-auto animate-fade-in">
                        <div className="sticky top-0 bg-slate-850 border-b border-slate-700 p-5 flex items-center justify-between"><div><h2 className="text-xl font-bold text-white">{client.company_name}</h2><p className="text-slate-400 text-sm">{client.industry || 'No industry'} ‚Ä¢ {client.funding_type || 'No funding type'}</p></div><button onClick={onClose} className="p-2 hover:bg-slate-700 rounded-lg">{Icons.close}</button></div>
                        <div className="p-5 space-y-6">
                            <button onClick={() => onUploadAnalyze(client)} className="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 rounded-xl font-medium flex items-center justify-center gap-2">{Icons.sparkles} Upload Census & Run Analysis</button>
                            <div className="bg-slate-900/50 rounded-xl p-4"><h3 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Details</h3><div className="space-y-2"><div className="flex justify-between"><span className="text-slate-400">Contact</span><span className="text-white">{client.contact_name || '‚Äî'}</span></div><div className="flex justify-between"><span className="text-slate-400">Email</span><span className="text-white">{client.contact_email || '‚Äî'}</span></div><div className="flex justify-between"><span className="text-slate-400">Employees</span><span className="text-white">{client.employee_count?.toLocaleString() || '‚Äî'}</span></div></div></div>
                            <div><h3 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Analyses ({clientAnalyses.length})</h3>{clientAnalyses.length === 0 ? <div className="bg-slate-900/50 rounded-xl p-6 text-center text-slate-500">No analyses yet</div> : <div className="space-y-2">{clientAnalyses.map(a => <div key={a.id} className="bg-slate-900/50 rounded-xl p-4 flex items-center justify-between cursor-pointer hover:bg-slate-800/50" onClick={() => setSelectedAnalysis(a)}><div><p className="text-white font-medium">{a.findings?.executive_summary?.substring(0,50) || 'Analysis'}...</p><p className="text-slate-500 text-sm">{new Date(a.created_at).toLocaleDateString()}</p></div><div className="flex items-center gap-2"><StatusBadge status={a.status} />{Icons.eye}</div></div>)}</div>}</div>
                        </div>
                    </div>
                    {selectedAnalysis && <AnalysisDetail analysis={selectedAnalysis} client={client} onClose={() => setSelectedAnalysis(null)} />}
                </div>
            );
        };
        
        // Main App
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [clients, setClients] = useState([]);
            const [uploads, setUploads] = useState([]);
            const [analyses, setAnalyses] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showAddClient, setShowAddClient] = useState(false);
            const [selectedClient, setSelectedClient] = useState(null);
            const [analyzeClient, setAnalyzeClient] = useState(null);
            const [selectedAnalysis, setSelectedAnalysis] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            
            const fetchData = useCallback(async () => { setLoading(true); try { const [c, u, a] = await Promise.all([supabase.from('clients').select('*').order('created_at', { ascending: false }), supabase.from('uploads').select('*').order('uploaded_at', { ascending: false }), supabase.from('analyses').select('*').order('created_at', { ascending: false })]); setClients(c.data || []); setUploads(u.data || []); setAnalyses(a.data || []); } catch (err) { console.error(err); } finally { setLoading(false); } }, []);
            useEffect(() => { fetchData(); }, [fetchData]);
            const handleAddClient = async (data) => { try { const { data: d, error: e } = await supabase.from('clients').insert([data]).select(); if (e) throw e; setClients([d[0], ...clients]); setShowAddClient(false); } catch (err) { alert('Error: ' + err.message); } };
            const handleDeleteClient = async (id) => { if (!confirm('Delete this client?')) return; try { await supabase.from('clients').delete().eq('id', id); setClients(clients.filter(c => c.id !== id)); } catch (err) { alert('Error: ' + err.message); } };
            const getClientById = (id) => clients.find(c => c.id === id);
            const filteredClients = clients.filter(c => c.company_name?.toLowerCase().includes(searchTerm.toLowerCase()));
            const stats = { totalClients: clients.length, activeClients: clients.filter(c => c.status === 'active').length, pendingUploads: uploads.filter(u => u.status === 'pending').length, completedAnalyses: analyses.filter(a => a.status === 'complete').length };
            
            return (
                <div className="min-h-screen flex">
                    <div className="w-64 bg-slate-850 border-r border-slate-700/50 flex flex-col">
                        <div className="p-5 border-b border-slate-700/50"><h1 className="text-xl font-bold text-white flex items-center gap-2"><span className="text-2xl">‚óâ</span>Canon Echo</h1><p className="text-slate-500 text-sm mt-1">Workforce Health Intelligence</p></div>
                        <nav className="flex-1 p-3">{[{ id: 'dashboard', label: 'Dashboard', icon: Icons.dashboard }, { id: 'clients', label: 'Clients', icon: Icons.clients }, { id: 'uploads', label: 'Uploads', icon: Icons.uploads }, { id: 'analyses', label: 'Analyses', icon: Icons.analyses }].map(item => <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-3 px-4 py-2.5 rounded-lg text-left mb-1 ${activeTab === item.id ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' : 'text-slate-400 hover:bg-slate-700/50'}`}>{item.icon}<span className="font-medium">{item.label}</span></button>)}</nav>
                        <div className="p-4 border-t border-slate-700/50"><div className="bg-slate-900/50 rounded-xl p-4 flex items-center gap-2"><div className="w-2 h-2 bg-green-500 rounded-full animate-pulse-subtle"></div><span className="text-sm text-slate-300">Vercel Pro</span></div></div>
                    </div>
                    <div className="flex-1 overflow-auto">
                        <div className="sticky top-0 z-10 bg-slate-950/80 backdrop-blur-xl border-b border-slate-700/50 px-8 py-4 flex items-center justify-between"><h2 className="text-2xl font-bold text-white capitalize">{activeTab}</h2><div className="flex items-center gap-3"><button onClick={fetchData} className="p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg">{Icons.refresh}</button>{activeTab === 'clients' && <button onClick={() => setShowAddClient(true)} className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium">{Icons.plus}Add Client</button>}</div></div>
                        <div className="p-8">
                            {loading ? <div className="text-center py-20 text-slate-500">Loading...</div> : (
                                <>
                                    {activeTab === 'dashboard' && <div className="space-y-8"><div className="grid grid-cols-4 gap-6"><StatCard title="Total Clients" value={stats.totalClients} icon={Icons.clients} color="bg-blue-500/20 text-blue-400" /><StatCard title="Active" value={stats.activeClients} icon={Icons.check} color="bg-green-500/20 text-green-400" /><StatCard title="Pending" value={stats.pendingUploads} icon={Icons.uploads} color="bg-amber-500/20 text-amber-400" /><StatCard title="Analyses" value={stats.completedAnalyses} icon={Icons.analyses} color="bg-purple-500/20 text-purple-400" /></div><div className="grid grid-cols-2 gap-6"><div className="bg-slate-850 border border-slate-700/50 rounded-xl"><div className="p-5 border-b border-slate-700/50"><h3 className="font-semibold text-white">Recent Clients</h3></div><div className="p-2">{clients.slice(0,5).map(c => <div key={c.id} className="p-3 hover:bg-slate-700/30 rounded-lg cursor-pointer flex items-center justify-between" onClick={() => setSelectedClient(c)}><p className="text-white font-medium">{c.company_name}</p><StatusBadge status={c.status} /></div>)}{clients.length === 0 && <p className="p-3 text-slate-500">No clients yet</p>}</div></div><div className="bg-slate-850 border border-slate-700/50 rounded-xl"><div className="p-5 border-b border-slate-700/50"><h3 className="font-semibold text-white">Recent Analyses</h3></div><div className="p-2">{analyses.slice(0,5).map(a => <div key={a.id} className="p-3 hover:bg-slate-700/30 rounded-lg cursor-pointer" onClick={() => setSelectedAnalysis(a)}><p className="text-white font-medium">{a.findings?.executive_summary?.substring(0,40) || 'Analysis'}...</p></div>)}{analyses.length === 0 && <p className="p-3 text-slate-500">No analyses yet</p>}</div></div></div></div>}
                                    {activeTab === 'clients' && <div className="space-y-6"><div className="relative"><div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-500">{Icons.search}</div><input type="text" placeholder="Search clients..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full bg-slate-850 border border-slate-700 rounded-xl pl-12 pr-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" /></div><div className="bg-slate-850 border border-slate-700/50 rounded-xl overflow-hidden"><table className="w-full"><thead><tr className="border-b border-slate-700/50"><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Company</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Industry</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Funding</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Status</th><th className="text-right px-6 py-4 text-sm font-semibold text-slate-400">Actions</th></tr></thead><tbody>{filteredClients.map((c, i) => <tr key={c.id} className={`border-b border-slate-700/30 hover:bg-slate-700/20 cursor-pointer ${i % 2 ? 'bg-slate-900/20' : ''}`} onClick={() => setSelectedClient(c)}><td className="px-6 py-4 text-white font-medium">{c.company_name}</td><td className="px-6 py-4 text-slate-300">{c.industry || '‚Äî'}</td><td className="px-6 py-4 text-slate-300">{c.funding_type || '‚Äî'}</td><td className="px-6 py-4"><StatusBadge status={c.status} /></td><td className="px-6 py-4 text-right" onClick={e => e.stopPropagation()}><button className="p-2 text-slate-400 hover:text-blue-400" onClick={() => setAnalyzeClient(c)}>{Icons.sparkles}</button><button className="p-2 text-slate-400 hover:text-red-400" onClick={() => handleDeleteClient(c.id)}>{Icons.trash}</button></td></tr>)}{filteredClients.length === 0 && <tr><td colSpan="5" className="px-6 py-8 text-center text-slate-500">No clients found</td></tr>}</tbody></table></div></div>}
                                    {activeTab === 'uploads' && <div className="bg-slate-850 border border-slate-700/50 rounded-xl overflow-hidden"><table className="w-full"><thead><tr className="border-b border-slate-700/50"><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">File</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Date</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Status</th></tr></thead><tbody>{uploads.map((u, i) => <tr key={u.id} className={`border-b border-slate-700/30 ${i % 2 ? 'bg-slate-900/20' : ''}`}><td className="px-6 py-4 text-white">{u.file_name}</td><td className="px-6 py-4 text-slate-300 mono text-sm">{new Date(u.uploaded_at).toLocaleString()}</td><td className="px-6 py-4"><StatusBadge status={u.status} /></td></tr>)}{uploads.length === 0 && <tr><td colSpan="3" className="px-6 py-8 text-center text-slate-500">No uploads yet</td></tr>}</tbody></table></div>}
                                    {activeTab === 'analyses' && <div className="bg-slate-850 border border-slate-700/50 rounded-xl overflow-hidden"><table className="w-full"><thead><tr className="border-b border-slate-700/50"><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Summary</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Date</th><th className="text-left px-6 py-4 text-sm font-semibold text-slate-400">Status</th></tr></thead><tbody>{analyses.map((a, i) => <tr key={a.id} className={`border-b border-slate-700/30 hover:bg-slate-700/20 cursor-pointer ${i % 2 ? 'bg-slate-900/20' : ''}`} onClick={() => setSelectedAnalysis(a)}><td className="px-6 py-4 text-white">{a.findings?.executive_summary?.substring(0,60) || 'Analysis'}...</td><td className="px-6 py-4 text-slate-300 mono text-sm">{new Date(a.created_at).toLocaleString()}</td><td className="px-6 py-4"><StatusBadge status={a.status} /></td></tr>)}{analyses.length === 0 && <tr><td colSpan="3" className="px-6 py-8 text-center text-slate-500">No analyses yet</td></tr>}</tbody></table></div>}
                                </>
                            )}
                        </div>
                    </div>
                    <Modal isOpen={showAddClient} onClose={() => setShowAddClient(false)} title="Add Client"><AddClientForm onSubmit={handleAddClient} onCancel={() => setShowAddClient(false)} /></Modal>
                    <Modal isOpen={!!analyzeClient} onClose={() => setAnalyzeClient(null)} title={`Analyze: ${analyzeClient?.company_name || ''}`} wide>{analyzeClient && <UploadAnalyze client={analyzeClient} onComplete={() => { setAnalyzeClient(null); fetchData(); }} onCancel={() => setAnalyzeClient(null)} />}</Modal>
                    {selectedClient && <ClientDetail client={selectedClient} uploads={uploads} analyses={analyses} onClose={() => setSelectedClient(null)} onUploadAnalyze={(c) => { setSelectedClient(null); setAnalyzeClient(c); }} />}
                    {selectedAnalysis && !selectedClient && <AnalysisDetail analysis={selectedAnalysis} client={getClientById(selectedAnalysis.client_id)} onClose={() => setSelectedAnalysis(null)} />}
                </div>
            );
        };
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
